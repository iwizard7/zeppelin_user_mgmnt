<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .dashboard-container {
            max-width: 900px;
            margin: 50px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <h2 class="text-center">Dashboard</h2>

        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ 'danger' if category == 'error' else 'warning' if category == 'warning' else 'success' }} alert-dismissible fade show"
            role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <!-- Zeppelin Status -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ Zeppelin</h5>
                <div>
                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="refreshStatus()">
                        <span id="refresh-icon">üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                    <form action="{{ url_for('start_zeppelin') }}" method="POST" class="d-inline"></form>
                    <button type="submit" class="btn btn-sm btn-success"
                        onclick="return confirm('–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å Zeppelin?')">
                        ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å
                    </button>
                    </form>
                    <form action="{{ url_for('stop_zeppelin') }}" method="POST" class="d-inline">
                        <button type="submit" class="btn btn-sm btn-danger"
                            onclick="return confirm('–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å Zeppelin?')">
                            ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                        </button>
                    </form>
                    <form action="{{ url_for('restart') }}" method="POST" class="d-inline">
                        <button type="submit" class="btn btn-sm btn-warning"
                            onclick="return confirm('–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å Zeppelin?')">
                            ‚ö° –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
                        </button>
                    </form>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div id="status-info">
                            {% if zeppelin_status %}
                            <div class="d-flex align-items-center mb-2">
                                <span class="badge bg-{{ zeppelin_status.status_class }} me-2">{{
                                    zeppelin_status.status_text }}</span>
                                <small class="text-muted">–°—Ç–∞—Ç—É—Å: {{ zeppelin_status.active }}</small>
                            </div>
                            {% if zeppelin_status.pid != 'N/A' %}
                            <p class="mb-1"><strong>PID:</strong> {{ zeppelin_status.pid }}</p>
                            {% endif %}
                            {% if zeppelin_status.memory_usage != 'N/A' %}
                            <p class="mb-1"><strong>–ü–∞–º—è—Ç—å:</strong> {{ zeppelin_status.memory_usage }}</p>
                            {% endif %}
                            {% if zeppelin_status.uptime != 'N/A' %}
                            <p class="mb-1"><strong>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</strong> {{ zeppelin_status.uptime }}</p>
                            {% endif %}
                            {% if zeppelin_status.enabled %}
                            <p class="mb-1"><strong>–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫:</strong> {{ zeppelin_status.enabled }}</p>
                            {% endif %}
                            {% if zeppelin_status.service_manager %}
                            <p class="mb-1"><strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong> {{ zeppelin_status.service_manager }}</p>
                            {% endif %}
                            {% if zeppelin_status.error %}
                            <div class="alert alert-danger mt-2">{{ zeppelin_status.error }}</div>
                            {% endif %}
                            {% else %}
                            <div class="alert alert-warning">–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="text-end">
                            <small class="text-muted">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span
                                    id="last-update">--:--:--</span></small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between mb-3">
            <h5>Users & Roles</h5>
            <div>
                <a href="{{ url_for('logout') }}" class="btn btn-danger">Logout</a>
            </div>
        </div>

    <div class="main-container">
        <div class="alert alert-info">
            <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Å—Ç–∞—Ç—É—Å–æ–º "–ó–∞—â–∏—â–µ–Ω" –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã —á–µ—Ä–µ–∑
            —ç—Ç–æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
        </div>

        <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div class="card mb-4 filter-card">
            <div class="card-header">
                <h6 class="mb-0">üîç –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h6>
            </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <input type="text" id="userSearch" class="form-control" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è..."
                        onkeyup="filterUsers()">
                </div>
                <div class="col-md-3">
                    <select id="roleFilter" class="form-select" onchange="filterUsers()">
                        <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
                        {% for role in roles.keys() %}
                        <option value="{{ role }}">{{ role }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <select id="statusFilter" class="form-select" onchange="filterUsers()">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="protected">–ó–∞—â–∏—â–µ–Ω–Ω—ã–µ</option>
                        <option value="normal">–û–±—ã—á–Ω—ã–µ</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-outline-secondary" onclick="clearFilters()">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-12">
                    <small class="text-muted">
                        –ù–∞–π–¥–µ–Ω–æ: <span id="userCount">{{ users|length }}</span> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    </small>
                </div>
            </div>
        </div>
    </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div class="card mb-4"></div>
        <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">üë• –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h6>
            <span class="badge bg-primary">–í—Å–µ–≥–æ: <span id="userCount">{{ users|length }}</span></span>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0" id="usersTable">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 30%">Username</th>
                            <th style="width: 45%">Roles</th>
                            <th style="width: 25%">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user, user_data in users.items() %}
                        <tr>
                            <td><strong>{{ user }}</strong></td>
                            <td>
                                {% if user_data.protected %}
                                <span class="text-muted">*** (–∑–∞—â–∏—â–µ–Ω–æ)</span>
                                {% else %}
                                {% for role in user_data.roles %}
                                <span class="badge bg-secondary me-1">{{ role }}</span>
                                {% endfor %}
                                {% endif %}
                            </td>
                            <td>
                                {% if user_data.protected %}
                                <span class="badge bg-warning">üîí –ó–∞—â–∏—â–µ–Ω</span>
                                {% else %}
                                <span class="badge bg-success">‚úì –û–±—ã—á–Ω—ã–π</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        </div>

        <!-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h6>
            </div>
            <div class="card-body">
                <form action="{{ url_for('add_user') }}" method="POST" class="form-row">
                    <input type="text" class="form-control" name="username" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required>
                    <input type="password" class="form-control" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                    <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å</button>
                </form>
            </div>
        </div>

        <!-- –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">üé≠ –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å</h6>
            </div>
            <div class="card-body">
                <form action="{{ url_for('assign_user_role') }}" method="POST" class="form-row">
                    <select class="form-select" name="username" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
                        {% for user, user_data in users.items() %}
                        {% if not user_data.protected %}
                        <option value="{{ user }}">{{ user }}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                    <select class="form-select" name="role" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                        {% for role in roles.keys() %}
                        <option value="{{ role }}">{{ role }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn btn-primary">–ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
                </form>
            </div>
        </div>

        <!-- –£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">üé≠‚ùå –£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å</h6>
            </div>
            <div class="card-body">
                <form action="{{ url_for('unassign_user_role') }}" method="POST" class="form-row">
                    <select class="form-select" name="username" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
                        {% for user, user_data in users.items() %}
                        {% if not user_data.protected %}
                        <option value="{{ user }}">{{ user }}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                    <select class="form-select" name="role" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                        {% for role in roles.keys() %}
                        <option value="{{ role }}">{{ role }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn btn-warning">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </div>
        </div>

        <!-- –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h6>
            </div>
            <div class="card-body">
                <form action="{{ url_for('delete_user') }}" method="POST" class="form-row">
                    <select class="form-select" name="username" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è</option>
                        {% for user, user_data in users.items() %}
                        {% if not user_data.protected %}
                        <option value="{{ user }}">{{ user }}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn btn-danger"
                        onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </div>
        </div>

        <!-- –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">üîë –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h6>
            </div>
            <div class="card-body">
                <form action="{{ url_for('change_password') }}" method="POST" class="form-row">
                    <select class="form-select" name="username" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
                        {% for user, user_data in users.items() %}
                        {% if not user_data.protected %}
                        <option value="{{ user }}">{{ user }}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                    <input type="password" class="form-control" name="new_password" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required>
                    <button type="submit" class="btn btn-info"
                        onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                </form>
            </div>
        </div>

        <!-- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">üè∑Ô∏è –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å</h6>
            </div>
            <div class="card-body">
                <form action="{{ url_for('add_role') }}" method="POST" class="form-row">
                    <input type="text" class="form-control" name="role_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–æ–ª–∏" required>
                    <button type="submit" class="btn btn-secondary">–î–æ–±–∞–≤–∏—Ç—å</button>
                </form>
            </div>
        </div>
    </div>
    </div>
    <footer></footer>
        &copy; iwizard7 | <a href="https://github.com/iwizard7/zeppelin_user_mgmnt" target="_blank">GitHub
            Repository</a>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function filterUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const roleFilter = document.getElementById('roleFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            const table = document.getElementById('usersTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            let visibleCount = 0;

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const username = row.cells[0].textContent.toLowerCase();
                const roles = row.cells[1].textContent.toLowerCase();
                const status = row.cells[2].textContent.toLowerCase();

                let showRow = true;

                // –§–∏–ª—å—Ç—Ä –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (searchTerm && !username.includes(searchTerm)) {
                    showRow = false;
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ —Ä–æ–ª–∏
                if (roleFilter && !roles.includes(roleFilter.toLowerCase())) {
                    showRow = false;
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
                if (statusFilter) {
                    if (statusFilter === 'protected' && !status.includes('–∑–∞—â–∏—â–µ–Ω')) {
                        showRow = false;
                    }
                    if (statusFilter === 'normal' && status.includes('–∑–∞—â–∏—â–µ–Ω')) {
                        showRow = false;
                    }
                }

                row.style.display = showRow ? '' : 'none';
                if (showRow) visibleCount++;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
            document.getElementById('userCount').textContent = visibleCount;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
            showNoResultsMessage(visibleCount === 0);
        }

        function clearFilters() {
            document.getElementById('userSearch').value = '';
            document.getElementById('roleFilter').value = '';
            document.getElementById('statusFilter').value = '';
            filterUsers();
        }

        function showNoResultsMessage(show) {
            let noResultsRow = document.getElementById('noResultsRow');

            if (show && !noResultsRow) {
                const table = document.getElementById('usersTable');
                const tbody = table.getElementsByTagName('tbody')[0];
                noResultsRow = document.createElement('tr');
                noResultsRow.id = 'noResultsRow';
                noResultsRow.innerHTML = '<td colspan="3" class="text-center text-muted py-4">üîç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞.</td>';
                tbody.appendChild(noResultsRow);
            } else if (!show && noResultsRow) {
                noResultsRow.remove();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function () {
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –¥–ª—è –ø–æ–∏—Å–∫–∞
            document.getElementById('userSearch').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    filterUsers();
                }
            });
        });

        let statusUpdateInterval;

        function refreshStatus() {
            const refreshIcon = document.getElementById('refresh-icon');
            const statusInfo = document.getElementById('status-info');
            const lastUpdate = document.getElementById('last-update');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            refreshIcon.style.animation = 'spin 1s linear infinite';

            fetch('/check_zeppelin_status')
                .then(response => response.json())
                .then(data => {
                    updateStatusDisplay(data);
                    lastUpdate.textContent = new Date().toLocaleTimeString();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
                    statusInfo.innerHTML = '<div class="alert alert-danger">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞</div>';
                })
                .finally(() => {
                    // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                    refreshIcon.style.animation = '';
                });
        }

        function updateStatusDisplay(status) {
            const statusInfo = document.getElementById('status-info');

            let html = `
                <div class="d-flex align-items-center mb-2">
                    <span class="badge bg-${status.status_class} me-2">${status.status_text}</span>
                    <small class="text-muted">–°—Ç–∞—Ç—É—Å: ${status.active || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</small>
                </div>
            `;

            if (status.pid && status.pid !== 'N/A') {
                html += `<p class="mb-1"><strong>PID:</strong> ${status.pid}</p>`;
            }

            if (status.memory_usage && status.memory_usage !== 'N/A') {
                html += `<p class="mb-1"><strong>–ü–∞–º—è—Ç—å:</strong> ${status.memory_usage}</p>`;
            }

            if (status.uptime && status.uptime !== 'N/A') {
                html += `<p class="mb-1"><strong>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</strong> ${status.uptime}</p>`;
            }

            if (status.enabled) {
                html += `<p class="mb-1"><strong>–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫:</strong> ${status.enabled}</p>`;
            }

            if (status.service_manager) {
                html += `<p class="mb-1"><strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong> ${status.service_manager}</p>`;
            }

            if (status.error) {
                html += `<div class="alert alert-danger mt-2">${status.error}</div>`;
            }

            statusInfo.innerHTML = html;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        function startAutoRefresh() {
            statusUpdateInterval = setInterval(refreshStatus, 30000);
        }

        function stopAutoRefresh() {
            if (statusUpdateInterval) {
                clearInterval(statusUpdateInterval);
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function () {
            startAutoRefresh();
        });

        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', function () {
            stopAutoRefresh();
        });

        // CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—Ä–∞—â–µ–Ω–∏—è
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
            #userSearch:focus {
                border-color: #0d6efd;
                box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
            }
            
            .search-highlight {
                background-color: #fff3cd;
                padding: 2px 4px;
                border-radius: 3px;
            }
            
            /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —à–∏—Ä–∏–Ω–æ–π */
            .main-container {
                max-width: 900px;
                margin: 0 auto;
                padding: 0 15px;
            }
            
            .card {
                border: none;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                transition: transform 0.2s ease, box-shadow 0.2s ease;
                margin-bottom: 1.5rem;
            }
            
            .card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            }
            
            .card-header {
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                border-bottom: 1px solid #dee2e6;
                padding: 1rem 1.25rem;
            }
            
            .filter-card {
                border-left: 4px solid #0d6efd;
            }
            
            .card-body {
                padding: 1.25rem;
            }
            
            /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º */
            .form-row {
                display: flex;
                gap: 15px;
                align-items: center;
            }
            
            .form-row .form-control,
            .form-row .form-select {
                flex: 1;
            }
            
            .form-row .btn {
                min-width: 120px;
                white-space: nowrap;
            }
            
            #usersTable tbody tr {
                transition: all 0.3s ease;
            }
            
            #usersTable tbody tr:hover {
                background-color: #f8f9fa;
            }
            
            #usersTable tbody tr[style*="none"] {
                opacity: 0;
                transform: scale(0.95);
            }
            
            .btn {
                border-radius: 6px;
                font-weight: 500;
            }
            
            .badge {
                font-size: 0.75em;
            }
            
            /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
            @media (max-width: 768px) {
                .main-container {
                    max-width: 100%;
                    padding: 0 10px;
                }
                
                .form-row {
                    flex-direction: column;
                    gap: 10px;
                }
                
                .form-row .btn {
                    width: 100%;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>

</html>