<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard for Apache Zeppelin user management with real-time monitoring, dark/light themes, and advanced search">
    <meta name="author" content="iwizard7">
    <meta name="theme-color" content="#0d6efd">
    <title>üöÄ Zeppelin User Management - Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="alternate icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='themes.css') }}" rel="stylesheet">
    <style>
        .dashboard-container {
            max-width: 900px;
            margin: 20px auto;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .navbar {
            margin-bottom: 0;
        }

        .navbar-text small {
            font-size: 0.8em;
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Ç–µ–º–Ω–æ–π —Ç–µ–º–æ–π */
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--card-shadow);
        }

        #usersTable tbody tr:hover {
            background-color: var(--table-hover-bg);
        }

        #usersTable tbody tr[style*="none"] {
            opacity: 0;
            transform: scale(0.95);
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
        [data-theme="dark"] .table {
            --bs-table-bg: var(--card-bg);
            --bs-table-color: var(--text-color);
        }

        [data-theme="dark"] .table-light {
            --bs-table-bg: var(--bg-secondary);
            --bs-table-color: var(--text-color);
        }

        [data-theme="dark"] .table-hover>tbody>tr:hover>* {
            --bs-table-bg: var(--table-hover-bg);
        }
        
        /* UX —É–ª—É—á—à–µ–Ω–∏—è */
        .btn {
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .form-control:focus {
            transform: scale(1.02);
            transition: transform 0.2s ease;
        }
        
        .card {
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px var(--card-shadow);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        #userCount {
            transition: all 0.3s ease;
        }
        
        #userCount.updated {
            color: #0d6efd;
            font-weight: bold;
            transform: scale(1.1);
        }
        
        /* –ü—É–ª—å—Å–∞—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .btn-pulse {
            animation: pulse 2s infinite;
        }
        
        /* Live –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes liveGlow {
            0% { box-shadow: 0 0 5px rgba(25, 135, 84, 0.5); }
            50% { box-shadow: 0 0 20px rgba(25, 135, 84, 0.8); }
            100% { box-shadow: 0 0 5px rgba(25, 135, 84, 0.5); }
        }
        
        .badge.bg-success {
            animation: liveGlow 2s infinite;
        }
        
        /* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã */
        .status-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .status-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è toast'–æ–≤ */
        .toast {
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç ripple –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .btn {
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transition: width 0.6s, height 0.6s;
            transform: translate(-50%, -50%);
            z-index: 0;
        }
        
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        /* –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ —Ñ–æ–Ω—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ */
        .status-running {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        
        .status-stopped {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
        }
        
        .status-unknown {
            background: linear-gradient(135deg, #6c757d, #adb5bd);
            color: white;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ toast'—ã */
        .toast {
            backdrop-filter: blur(10px);
            border-radius: 12px;
        }
        
        /* Smooth scroll */
        html {
            scroll-behavior: smooth;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–π focus –¥–ª—è accessibility */
        .btn:focus,
        .form-control:focus,
        .form-select:focus {
            outline: 2px solid #0d6efd;
            outline-offset: 2px;
        }
    </style>
</head>

<body>
    <!-- –ù–∞–≤–±–∞—Ä -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <span class="navbar-brand">üöÄ Zeppelin User Management</span>
            <div class="navbar-nav ms-auto d-flex align-items-center">
                <button id="navbar-theme-toggle" class="btn btn-outline-light btn-sm me-3" onclick="toggleTheme()"
                    title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                    <span id="theme-icon">üåô</span>
                </button>

                <span class="navbar-text me-3">
                    üë§ {{ session.username }}
                    <small class="text-muted">| –°–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞</small>
                    <span id="liveIndicator" class="badge bg-secondary ms-2">üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
                </span>
                <a class="nav-link" href="{{ url_for('logout') }}" onclick="sessionStorage.removeItem('welcomeShown')">
                    <button class="btn btn-outline-light btn-sm">–í—ã–π—Ç–∏</button>
                </a>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <div class="dashboard-container">
            <h2 class="text-center">Dashboard</h2>

            <!-- Flash messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ 'danger' if category == 'error' else 'warning' if category == 'warning' else 'success' }} alert-dismissible fade show"
                role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
            {% endif %}
            {% endwith %}

            <!-- Zeppelin Status -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ Zeppelin</h6>
                    <div>
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="refreshStatus()" id="refreshBtn">
                            <span id="refresh-icon">üîÑ</span> 
                            <span class="btn-text">–û–±–Ω–æ–≤–∏—Ç—å</span>
                        </button>
                        <form action="{{ url_for('start_zeppelin') }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-success"
                                onclick="return confirm('–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å Zeppelin?')">
                                ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å
                            </button>
                        </form>
                        <form action="{{ url_for('stop_zeppelin') }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-danger"
                                onclick="return confirm('–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å Zeppelin?')">
                                ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                            </button>
                        </form>
                        <form action="{{ url_for('restart') }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-warning"
                                onclick="return confirm('–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å Zeppelin?')">
                                ‚ö° –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
                            </button>
                        </form>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div id="status-info">
                                {% if zeppelin_status %}
                                <div class="d-flex align-items-center mb-2">
                                    <span class="badge bg-{{ zeppelin_status.status_class }} me-2">{{
                                        zeppelin_status.status_text }}</span>
                                    <small class="text-muted">–°—Ç–∞—Ç—É—Å: {{ zeppelin_status.active }}</small>
                                </div>
                                {% if zeppelin_status.pid != 'N/A' %}
                                <p class="mb-1"><strong>PID:</strong> {{ zeppelin_status.pid }}</p>
                                {% endif %}
                                {% if zeppelin_status.memory_usage != 'N/A' %}
                                <p class="mb-1"><strong>–ü–∞–º—è—Ç—å:</strong> {{ zeppelin_status.memory_usage }}</p>
                                {% endif %}
                                {% if zeppelin_status.uptime != 'N/A' %}
                                <p class="mb-1"><strong>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</strong> {{ zeppelin_status.uptime }}</p>
                                {% endif %}
                                {% if zeppelin_status.enabled %}
                                <p class="mb-1"><strong>–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫:</strong> {{ zeppelin_status.enabled }}</p>
                                {% endif %}
                                {% if zeppelin_status.service_manager %}
                                <p class="mb-1"><strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong> {{ zeppelin_status.service_manager }}</p>
                                {% endif %}
                                {% if zeppelin_status.error %}
                                <div class="alert alert-danger mt-2">{{ zeppelin_status.error }}</div>
                                {% endif %}
                                {% else %}
                                <div class="alert alert-warning">–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-end">
                                <small class="text-muted">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span
                                        id="last-update">--:--:--</span></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="alert alert-info alert-dismissible fade show" role="alert" id="protectedUsersInfo">
                <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Å—Ç–∞—Ç—É—Å–æ–º "–ó–∞—â–∏—â–µ–Ω" –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã
                —á–µ—Ä–µ–∑
                —ç—Ç–æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
            </div>

            <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="card mb-4 filter-card">
                <div class="card-header">
                    <h6 class="mb-0">üîç –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <input type="text" id="userSearch" class="form-control"
                                placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è..." onkeyup="filterUsers()">
                        </div>
                        <div class="col-md-3">
                            <select id="roleFilter" class="form-select" onchange="filterUsers()">
                                <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
                                {% for role in roles.keys() %}
                                <option value="{{ role }}">{{ role }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select id="statusFilter" class="form-select" onchange="filterUsers()">
                                <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                <option value="protected">–ó–∞—â–∏—â–µ–Ω–Ω—ã–µ</option>
                                <option value="normal">–û–±—ã—á–Ω—ã–µ</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-outline-secondary" onclick="clearFilters()">
                                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-12">
                            <small class="text-muted">
                                –ù–∞–π–¥–µ–Ω–æ: <span id="userCount">{{ users|length }}</span> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">üë• –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h6>
                    <span class="badge bg-primary">–í—Å–µ–≥–æ: <span id="userCount">{{ users|length }}</span></span>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0" id="usersTable">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 30%">Username</th>
                                    <th style="width: 45%">Roles</th>
                                    <th style="width: 25%">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user, user_data in users.items() %}
                                <tr>
                                    <td><strong>{{ user }}</strong></td>
                                    <td>
                                        {% if user_data.protected %}
                                        <span class="text-muted">*** (–∑–∞—â–∏—â–µ–Ω–æ)</span>
                                        {% else %}
                                        {% for role in user_data.roles %}
                                        <span class="badge bg-secondary me-1">{{ role }}</span>
                                        {% endfor %}
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if user_data.protected %}
                                        <span class="badge bg-warning">üîí –ó–∞—â–∏—â–µ–Ω</span>
                                        {% else %}
                                        <span class="badge bg-success">‚úì –û–±—ã—á–Ω—ã–π</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h6>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('add_user') }}" method="POST" class="form-row">
                        <input type="text" class="form-control" name="username" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required>
                        <input type="password" class="form-control" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                        <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </form>
                </div>
            </div>

            <!-- –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">üé≠ –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å</h6>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('assign_user_role') }}" method="POST" class="form-row">
                        <select class="form-select" name="username" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
                            {% for user, user_data in users.items() %}
                            {% if not user_data.protected %}
                            <option value="{{ user }}">{{ user }}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                        <select class="form-select" name="role" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                            {% for role in roles.keys() %}
                            <option value="{{ role }}">{{ role }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-primary">–ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
                    </form>
                </div>
            </div>

            <!-- –£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">üé≠‚ùå –£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å</h6>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('unassign_user_role') }}" method="POST" class="form-row">
                        <select class="form-select" name="username" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
                            {% for user, user_data in users.items() %}
                            {% if not user_data.protected %}
                            <option value="{{ user }}">{{ user }}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                        <select class="form-select" name="role" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                            {% for role in roles.keys() %}
                            <option value="{{ role }}">{{ role }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                </div>
            </div>

            <!-- –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h6>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('delete_user') }}" method="POST" class="form-row">
                        <select class="form-select" name="username" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è</option>
                            {% for user, user_data in users.items() %}
                            {% if not user_data.protected %}
                            <option value="{{ user }}">{{ user }}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-danger"
                            onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')">–£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                </div>
            </div>

            <!-- –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">üîë –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h6>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('change_password') }}" method="POST" class="form-row">
                        <select class="form-select" name="username" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
                            {% for user, user_data in users.items() %}
                            {% if not user_data.protected %}
                            <option value="{{ user }}">{{ user }}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                        <input type="password" class="form-control" name="new_password" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å"
                            required>
                        <button type="submit" class="btn btn-info"
                            onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                    </form>
                </div>
            </div>

            <!-- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">üè∑Ô∏è –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å</h6>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('add_role') }}" method="POST" class="form-row">
                        <input type="text" class="form-control" name="role_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–æ–ª–∏"
                            required>
                        <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer">
        <!-- Toasts –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>
    
    <footer class="text-center py-3 mt-4">
        &copy; iwizard7 | <a href="https://github.com/iwizard7/zeppelin_user_mgmnt" target="_blank">GitHub
            Repository</a>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>

    <!-- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–º—ã -->
    <script>
        (function () {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            }
        })();
    </script>

    <!-- –ì–õ–ê–í–ù–´–ô JAVASCRIPT –ë–õ–û–ö -->
    <script>
        console.log('üöÄ JavaScript –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–ª–∞–¥–∫–∏ (—Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Å–æ–ª—å)
        function updateDebug(message) {
            console.log('üêõ', message);
        }

        // –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –¢–ï–ú–´
        function toggleTheme() {
            console.log('üé® toggleTheme() –≤—ã–∑–≤–∞–Ω–∞!');

            try {
                const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';

                console.log('–ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–º—É:', currentTheme, '‚Üí', newTheme);

                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
                const icon = document.getElementById('theme-icon');
                if (icon) {
                    icon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                    console.log('‚úÖ –ò–∫–æ–Ω–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞:', icon.textContent);
                }

                console.log('‚úÖ –¢–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞ –Ω–∞:', newTheme);

            } catch (error) {
                console.error('üí• –û—à–∏–±–∫–∞:', error);
            }
        }

        // –§–£–ù–ö–¶–ò–ò –ü–û–ò–°–ö–ê –ò –§–ò–õ–¨–¢–†–ê–¶–ò–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô
        function filterUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const roleFilter = document.getElementById('roleFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            const table = document.getElementById('usersTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            let visibleCount = 0;

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const username = row.cells[0].textContent.toLowerCase();
                const roles = row.cells[1].textContent.toLowerCase();
                const status = row.cells[2].textContent.toLowerCase();

                let showRow = true;

                // –§–∏–ª—å—Ç—Ä –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (searchTerm && !username.includes(searchTerm)) {
                    showRow = false;
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ —Ä–æ–ª–∏
                if (roleFilter && !roles.includes(roleFilter.toLowerCase())) {
                    showRow = false;
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
                if (statusFilter) {
                    if (statusFilter === 'protected' && !status.includes('–∑–∞—â–∏—â–µ–Ω')) {
                        showRow = false;
                    }
                    if (statusFilter === 'normal' && status.includes('–∑–∞—â–∏—â–µ–Ω')) {
                        showRow = false;
                    }
                }

                row.style.display = showRow ? '' : 'none';
                if (showRow) visibleCount++;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
            document.getElementById('userCount').textContent = visibleCount;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
            showNoResultsMessage(visibleCount === 0);
        }

        function clearFilters() {
            document.getElementById('userSearch').value = '';
            document.getElementById('roleFilter').value = '';
            document.getElementById('statusFilter').value = '';
            filterUsers();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
        function resetProtectedUsersInfo() {
            localStorage.removeItem('protectedUsersInfoDismissed');
            const protectedUsersInfo = document.getElementById('protectedUsersInfo');
            if (protectedUsersInfo) {
                protectedUsersInfo.style.display = 'block';
                console.log('‚ÑπÔ∏è –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–±—Ä–æ—à–µ–Ω–æ');
            }
        }

        function showNoResultsMessage(show) {
            let noResultsRow = document.getElementById('noResultsRow');

            if (show && !noResultsRow) {
                const table = document.getElementById('usersTable');
                const tbody = table.getElementsByTagName('tbody')[0];
                noResultsRow = document.createElement('tr');
                noResultsRow.id = 'noResultsRow';
                noResultsRow.innerHTML = '<td colspan="3" class="text-center text-muted py-4">üîç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞.</td>';
                tbody.appendChild(noResultsRow);
            } else if (!show && noResultsRow) {
                noResultsRow.remove();
            }
        }

        // –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –°–¢–ê–¢–£–°–û–ú ZEPPELIN
        let statusUpdateInterval;

        function refreshStatus() {
            const refreshIcon = document.getElementById('refresh-icon');
            const statusInfo = document.getElementById('status-info');
            const lastUpdate = document.getElementById('last-update');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            refreshIcon.style.animation = 'spin 1s linear infinite';

            fetch('/check_zeppelin_status')
                .then(response => response.json())
                .then(data => {
                    updateStatusDisplay(data);
                    lastUpdate.textContent = new Date().toLocaleTimeString();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
                    statusInfo.innerHTML = '<div class="alert alert-danger">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞</div>';
                })
                .finally(() => {
                    // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                    refreshIcon.style.animation = '';
                });
        }

        function updateStatusDisplay(status) {
            const statusInfo = document.getElementById('status-info');

            let html = `
                <div class="d-flex align-items-center mb-2">
                    <span class="badge bg-${status.status_class} me-2">${status.status_text}</span>
                    <small class="text-muted">–°—Ç–∞—Ç—É—Å: ${status.active || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</small>
                </div>
            `;

            if (status.pid && status.pid !== 'N/A') {
                html += `<p class="mb-1"><strong>PID:</strong> ${status.pid}</p>`;
            }

            if (status.memory_usage && status.memory_usage !== 'N/A') {
                html += `<p class="mb-1"><strong>–ü–∞–º—è—Ç—å:</strong> ${status.memory_usage}</p>`;
            }

            if (status.uptime && status.uptime !== 'N/A') {
                html += `<p class="mb-1"><strong>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</strong> ${status.uptime}</p>`;
            }

            if (status.enabled) {
                html += `<p class="mb-1"><strong>–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫:</strong> ${status.enabled}</p>`;
            }

            if (status.service_manager) {
                html += `<p class="mb-1"><strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong> ${status.service_manager}</p>`;
            }

            if (status.error) {
                html += `<div class="alert alert-danger mt-2">${status.error}</div>`;
            }

            statusInfo.innerHTML = html;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        function startAutoRefresh() {
            statusUpdateInterval = setInterval(refreshStatus, 30000);
        }

        function stopAutoRefresh() {
            if (statusUpdateInterval) {
                clearInterval(statusUpdateInterval);
            }
        }

        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏
        window.toggleTheme = toggleTheme;
        window.filterUsers = filterUsers;
        window.clearFilters = clearFilters;
        window.refreshStatus = refreshStatus;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üöÄ DOM –∑–∞–≥—Ä—É–∂–µ–Ω');

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
            const protectedUsersInfo = document.getElementById('protectedUsersInfo');
            if (protectedUsersInfo) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–æ –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ —Ä–∞–Ω–µ–µ
                const isInfoDismissed = localStorage.getItem('protectedUsersInfoDismissed');
                if (isInfoDismissed === 'true') {
                    protectedUsersInfo.style.display = 'none';
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è
                protectedUsersInfo.addEventListener('closed.bs.alert', function () {
                    localStorage.setItem('protectedUsersInfoDismissed', 'true');
                    console.log('‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ localStorage');
                });
            }

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∏–∫–æ–Ω–∫—É
            const icon = document.getElementById('theme-icon');
            if (icon) {
                icon.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const userSearch = document.getElementById('userSearch');
            if (userSearch) {
                userSearch.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        filterUsers();
                    }
                });
            }

            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ Zeppelin
            if (document.getElementById('status-info')) {
                startAutoRefresh();
            }

            console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        });

        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', function () {
            stopAutoRefresh();
        });

        console.log('‚úÖ JavaScript –∑–∞–≥—Ä—É–∂–µ–Ω');
        
        // üöÄ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è live –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        const socket = io();
        let isConnected = false;
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ WebSocket —Å–æ–±—ã—Ç–∏–π
        socket.on('connect', function() {
            console.log('üîó WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω');
            isConnected = true;
            showToast('üîó Live –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã', 'info', 2000);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            const indicator = document.getElementById('liveIndicator');
            if (indicator) {
                indicator.className = 'badge bg-success ms-2';
                indicator.textContent = 'üü¢ Live';
            }
        });
        
        socket.on('disconnect', function() {
            console.log('‚ùå WebSocket –æ—Ç–∫–ª—é—á–µ–Ω');
            isConnected = false;
            showToast('‚ö†Ô∏è Live –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã', 'warning', 3000);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            const indicator = document.getElementById('liveIndicator');
            if (indicator) {
                indicator.className = 'badge bg-warning ms-2';
                indicator.textContent = 'üü° –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            }
        });
        
        socket.on('connected', function(data) {
            console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:', data.message);
        });
        
        // Live –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ Zeppelin
        socket.on('status_change', function(data) {
            console.log('üìä –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞:', data);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
            updateStatusDisplay(data.status);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–µ–π—Å—Ç–≤–∏–∏ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (data.user !== '{{ session.username }}') {
                const actionNames = {
                    'start': '‚ñ∂Ô∏è –∑–∞–ø—É—Å—Ç–∏–ª',
                    'stop': '‚èπÔ∏è –æ—Å—Ç–∞–Ω–æ–≤–∏–ª', 
                    'restart': '‚ö° –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª'
                };
                const actionName = actionNames[data.action] || data.action;
                showToast(`üë§ ${data.user} ${actionName} Zeppelin`, 'info', 4000);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        socket.on('auto_status_update', function(data) {
            console.log('üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞');
            updateStatusDisplay(data.status);
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
        });
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        socket.on('user_change', function(data) {
            console.log('üë• –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', data);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const userCountElements = document.querySelectorAll('#userCount');
            userCountElements.forEach(el => {
                el.textContent = data.total_users;
                el.classList.add('updated');
                setTimeout(() => el.classList.remove('updated'), 1000);
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const actionNames = {
                'add': '‚ûï –¥–æ–±–∞–≤–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
                'delete': 'üóëÔ∏è —É–¥–∞–ª–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
                'update': '‚úèÔ∏è –æ–±–Ω–æ–≤–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'
            };
            const actionName = actionNames[data.action] || '–∏–∑–º–µ–Ω–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π';
            showToast(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${actionName}: ${data.username}`, 'info', 3000);
        });
        
        // –û—à–∏–±–∫–∏ WebSocket
        socket.on('error', function(data) {
            console.error('‚ùå WebSocket –æ—à–∏–±–∫–∞:', data);
            showToast(`‚ùå –û—à–∏–±–∫–∞: ${data.message}`, 'danger', 5000);
        });
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function requestStatusUpdate() {
            if (isConnected) {
                socket.emit('request_status_update');
            }
        }
        
        // UX —É–ª—É—á—à–µ–Ω–∏—è
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showToast(message, type = 'info', duration = 3000) {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const toastHtml = `
                <div class="toast align-items-center text-bg-${type} border-0" role="alert" aria-live="assertive" aria-atomic="true" id="${toastId}">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, { delay: duration });
            toast.show();
            
            // –£–¥–∞–ª—è–µ–º toast –ø–æ—Å–ª–µ —Å–∫—Ä—ã—Ç–∏—è
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }
        
        // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        const originalRefreshStatus = window.refreshStatus;
        window.refreshStatus = function() {
            const refreshBtn = document.getElementById('refreshBtn');
            const refreshIcon = document.getElementById('refresh-icon');
            const btnText = refreshBtn.querySelector('.btn-text');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º loading —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            refreshBtn.disabled = true;
            refreshIcon.style.animation = 'spin 1s linear infinite';
            btnText.textContent = '–û–±–Ω–æ–≤–ª—è–µ–º...';
            
            // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
            originalRefreshStatus();
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                refreshBtn.disabled = false;
                refreshIcon.style.animation = '';
                btnText.textContent = '–û–±–Ω–æ–≤–∏—Ç—å';
            }, 2000);
        };
        
        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
        const criticalForms = document.querySelectorAll('form[action*="delete"], form[action*="stop"], form[action*="restart"]');
        criticalForms.forEach(form => {
            form.addEventListener('submit', function(e) {
                const action = this.action.split('/').pop();
                const actionNames = {
                    'delete_user': '—É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
                    'stop_zeppelin': '–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Zeppelin',
                    'restart_zeppelin': '–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Zeppelin'
                };
                
                const actionName = actionNames[action] || '–≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ';
                if (!confirm(`‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${actionName}?`)) {
                    e.preventDefault();
                }
            });
        });
        
        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–º—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
        const originalToggleTheme = window.toggleTheme;
        window.toggleTheme = function() {
            originalToggleTheme();
            const currentTheme = document.documentElement.getAttribute('data-theme');
            showToast(`üé® –¢–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞ –Ω–∞ ${currentTheme === 'dark' ? '—Ç–µ–º–Ω—É—é' : '—Å–≤–µ—Ç–ª—É—é'}`, 'info', 2000);
        };
        
        // –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ —Å debounce
        let searchTimeout;
        const userSearch = document.getElementById('userSearch');
        if (userSearch) {
            userSearch.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    filterUsers();
                    const count = document.getElementById('userCount').textContent;
                    if (this.value) {
                        showToast(`üîç –ù–∞–π–¥–µ–Ω–æ: ${count} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`, 'info', 1500);
                    }
                }, 300);
            });
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + K –¥–ª—è —Ñ–æ–∫—É—Å–∞ –Ω–∞ –ø–æ–∏—Å–∫–µ
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchField = document.getElementById('userSearch');
                if (searchField) {
                    searchField.focus();
                    searchField.select();
                    showToast('üîç –ü–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω', 'info', 1000);
                }
            }
            
            // Ctrl/Cmd + T –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
            if ((e.ctrlKey || e.metaKey) && e.key === 't') {
                e.preventDefault();
                toggleTheme();
            }
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ
        const hasShownWelcome = sessionStorage.getItem('welcomeShown');
        if (!hasShownWelcome) {
            setTimeout(() => {
                showToast('üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Zeppelin User Management!', 'primary', 4000);
                sessionStorage.setItem('welcomeShown', 'true');
            }, 1000);
        }
    </script>
</body>

</html>